name: test

on: workflow_dispatch

jobs:
  test:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      
      - name: Prerequisites
        run: |
          sudo apt install php-cli php-mysql php-dom mysql-server sqlite3
          curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar
          curl -o composer.phar https://getcomposer.org/installer
          git clone https://github.com/dirtsimple/postmark
          curl -O -L https://github.com/elementor/wp2static/archive/refs/tags/7.2.tar.gz
      
      - name: Test
        run: |
          sudo service mysql start
          sudo mysql -h 127.0.0.1 --user=root --password=root <<< "CREATE USER 'wpssguser'@'127.0.0.1' IDENTIFIED WITH mysql_native_password BY 'wpssgpass';"
          sudo mysql -h 127.0.0.1 --user=wpssguser --password=wpssgpass <<< "SHOW DATABASES"

          php ./wp-cli.phar core download --locale=en_US #  --skip-content --force
          php ./wp-cli.phar config create --locale=en_US --dbuser=wpssguser --dbpass=wpssgpass --dbname=wpssgdb --dbhost=127.0.0.1
          cat wp-config.php
          php ./wp-cli.phar db create --dbuser=wpssguser@127.0.0.1
          #php ./wp-cli.phar core install --url=localhost:8080 --title=wpcli --admin_user=wpcli --admin_password=wpcli --admin_email=info@wp-cli.org
          #php wp-cli.phar option set permalink_structure '/%year%-%monthnum%-%day%-%postname%/'
       
#      - name: Artifacts
#        uses: actions/upload-artifact@v4
#        with:
#          path: test.so
